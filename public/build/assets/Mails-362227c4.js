import{_ as j,x as c,s as o,o as C,f as M,l as a,k as s,b as d}from"./app-7e0eada9.js";import{V as z,a as T,b as B,c as A}from"./VCardTitle-612be7de.js";import{T as D,V as F,S as P,b as R,a as U}from"./VDivider-99007ce3.js";import{V as W}from"./VTextarea-6e3da498.js";import{V as N}from"./VCardActions-cc1d1bdd.js";import"./ucfirst-206f84d9.js";const S={components:{VMain:z,VContainer:T,VForm:B,VCardActions:N,TextField:D,VBtn:F,SvgVue:P,VDivider:R,VTextarea:W,VCard:U,VCardTitle:A},data(){return{files:[],mail:{subject:"",message:"",newsletter:!0},users:[],loading:!1,valid:!0,rules:{titleRules:[e=>!!e||"To pole jest wymagane!"]}}},methods:{deleteMail(e){c.delete("/api/mails/delete/"+e.id)},async sendMail(e){let t=0;for(let n of this.users)e.email=n.email,e.newsletter=1,t==this.users.length-1&&(e.delete=1),await c.post("/api/mails/send",e).then(l=>{this.loading=!1,l.data.error!=null?this.$store.commit("toast",l.data.error.message):l.data.success!=null&&this.$store.commit("toast",l.data.success.message),t==this.users.length-1&&l.data.success&&(this.$refs.form.reset(),this.$refs.form.resetValidation(),this.deleteMail(e))}).catch(l=>{console.log(l),this.loading=!1,this.$store.commit("toast","Przepraszamy, nie udało się wysłać maila...")}),t++},async saveAttachments(e){for(let t=0;t<this.files.length;t++){let n=new FormData;n.append("file",this.files[t]),n.append("mail_id",e.id),await c.post("/api/attachments/add",n).then(l=>{t==this.files.length-1&&this.sendMail(e)}).catch(l=>{this.loading=!1,console.log(l),this.$store.commit("toast","Przepraszamy, nie udało się wysłać załączników...")})}},saveMail(){this.valid&&(this.loading=!0,c.post("/api/mails/add",this.mail).then(e=>{this.files.length>0?this.saveAttachments(e.data):this.sendMail(e.data)}).catch(e=>{console.log(e),this.loading=!1,this.$store.commit("toast","Przepraszamy, błąd serwera...")}))}}},$=d("h2",{class:"pt-4 font-weight-bold panel-title-header first-color"}," Wysyłanie maila do użytkowników ",-1),q=d("span",null,"Wyślij",-1),E=d("span",null,"Wróć",-1);function G(e,t,n,l,i,_){const p=o("v-card-title"),m=o("v-divider"),h=o("text-field"),v=o("v-textarea"),g=o("v-col"),V=o("v-row"),u=o("svg-vue"),f=o("v-btn"),w=o("v-card-actions"),b=o("v-form"),y=o("v-card"),x=o("v-container"),k=o("v-main");return C(),M(k,null,{default:a(()=>[s(x,null,{default:a(()=>[s(y,null,{default:a(()=>[s(p,{class:"justify-content-center"},{default:a(()=>[$]),_:1}),s(m,{class:"mt-0"}),s(b,{ref:"form",modelValue:i.valid,"onUpdate:modelValue":t[3]||(t[3]=r=>i.valid=r)},{default:a(()=>[s(V,{class:"px-5"},{default:a(()=>[s(g,{cols:"12"},{default:a(()=>[s(h,{rules:i.rules.titleRules,modelValue:i.mail.subject,"onUpdate:modelValue":t[0]||(t[0]=r=>i.mail.subject=r),label:"Temat Twojej wiadomości"},null,8,["rules","modelValue"]),s(v,{rules:i.rules.titleRules,modelValue:i.mail.message,"onUpdate:modelValue":t[1]||(t[1]=r=>i.mail.message=r),label:"Twoja wiadomość"},null,8,["rules","modelValue"])]),_:1})]),_:1}),s(m,{class:"mb-0"}),s(w,{class:"pa-4"},{default:a(()=>[s(f,{loading:i.loading,disabled:!i.valid||i.users.length==0,color:"primary",class:"mr-2",onClick:_.saveMail},{icon:a(()=>[s(u,{icon:"check"})]),default:a(()=>[q]),_:1},8,["loading","disabled","onClick"]),s(f,{color:"error",class:"mr-2",onClick:t[2]||(t[2]=r=>e.$router.go(-1))},{icon:a(()=>[s(u,{icon:"close"})]),default:a(()=>[E]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}const Q=j(S,[["render",G]]);export{Q as default};
