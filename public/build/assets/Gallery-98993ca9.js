import{_ as S,x as g,s,o as r,f as _,l,k as o,b as c,P as E,C as U,r as H,e as J,t as q,c as V,d as A,F,q as K,w as Q,T as Y,i as G,B as ee}from"./app-7e0eada9.js";import{V as W,i as te,p as oe,P as le}from"./Pagination-a0f8d3e7.js";import{V as M,a as B}from"./VCol-881ced2b.js";import{T as O,a as N,V as R,S as Z,b as se}from"./VDivider-99007ce3.js";import{b as X,V as ie,a as ae,c as ne}from"./VCardTitle-612be7de.js";import{S as b}from"./snackbar-alerts-6b28df32.js";import{V as re}from"./VCardActions-cc1d1bdd.js";import"./ucfirst-206f84d9.js";const ce={components:{VRow:M,TextField:O,VCard:N,VCardText:W,VCol:B,VBtn:R,SvgVue:Z,VForm:X},data(){return{file:[],loading:!1,valid:!0,rules:[e=>{let a=[];for(let w of e)w.size>25e6&&a.push(w.name);return a.length===0||`Pliki [${a.join(", ")}] nie powinny być większe niż 25 MB!`},e=>{let t=[];for(let a of e)te(a.type)||t.push(a.name);return t.length===0||`Pliki [${t.join(", ")}] powinny być zdjęciami!`}]}},computed:{photoTypes(){return oe.join(", ")},img(){return this.file.length==0?"https://via.placeholder.com/250":URL.createObjectURL(this.file[0])}},methods:{submit(){if(!(this.file.length==0||!this.valid)){this.loading=!0;for(let e=0;e<this.file.length;e++){let t=new FormData;t.append("file",this.file[e]),g.post("/api/media/add",t).then(()=>{this.loading=!1,this.$emit("loadPhotos"),this.file=[],this.$store.commit("toast","Pomyślnie dodano!")}).catch(a=>{this.loading=!1,console.error(a),this.$store.commit("toast","Coś poszło nie tak...")})}}}}},de=c("span",null,"Wyślij",-1);function he(e,t,a,w,i,n){const v=s("text-field"),u=s("svg-vue"),C=s("v-btn"),f=s("v-form"),y=s("v-col"),j=s("v-row"),p=s("v-card-text"),k=s("v-card");return r(),_(k,{flat:""},{default:l(()=>[o(p,null,{default:l(()=>[o(j,{class:"d-flex justify-content-center"},{default:l(()=>[o(y,{lg:"4",sm:"12",md:"4"},{default:l(()=>[o(f,{ref:"form",modelValue:i.valid,"onUpdate:modelValue":t[1]||(t[1]=P=>i.valid=P),"lazy-validation":""},{default:l(()=>[o(v,{id:"file",modelValue:i.file,"onUpdate:modelValue":t[0]||(t[0]=P=>i.file=P),multiple:"","show-size":"",counter:"",label:"Zdjęcie",accept:n.photoTypes,icon:"camera",type:"file",rules:i.rules},null,8,["modelValue","accept","rules"]),o(C,{disabled:i.loading||!i.valid||i.file.length===0,loading:i.loading,onClick:n.submit,color:"success"},{icon:l(()=>[o(u,{icon:"check"})]),default:l(()=>[de]),_:1},8,["disabled","loading","onClick"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}const ue=S(ce,[["render",he]]);const pe={directives:{},components:{VRow:M,SvgVue:Z,Pagination:le,VCard:N,TextField:O,VCardText:W,VCol:B,VBtn:R,AddPhotos:ue,Picture:E},props:["apiGallery","title"],data(){return{modal:!1,tab:null,tabs:["Wybierz zdjęcia","Dodaj Nowe Zdjęcie"],photos:[],activePhotos:[],multiple:!0,closeIcon:0,placeholder:"/storage/img/placeholder/250.png",search:"",page:1}},watch:{apiGallery(){this.loadPhotos(),this.activePhotos=[]},modal(e){document.querySelector("html").style.overflow=e?"hidden":""}},computed:{filteredPhotos(){let e=[];for(let t of this.photos)t.path.toLowerCase().includes(this.search.toLowerCase())&&e.push(t);return e.reverse().slice((this.page-1)*12,(this.page-1)*12+12)}},methods:{url:U,showCloseIcon(e){this.closeIcon=e},isActivePhotoDeleted(e){if(this.activePhotoPath!==null)for(let t of this.photos)t.id==e&&this.activePhotos.includes(e)&&this.$emit("updateDeletedPhoto",t.path)},setApiGallery(){if(this.apiGallery){let e=[];for(let t=0;t<this.photos.length;t++)this.apiGallery.some(a=>a.path==this.photos[t].path)||e.includes(this.photos[t])||e.push(this.photos[t]);this.photos=e}},loadPhotos(){g.get("/api/media/get_photos").then(e=>{this.photos=e.data,this.setApiGallery()})},deletePhoto(e){confirm("Czy na pewno?")&&g.delete("/api/media/delete/"+e).then(t=>{this.isActivePhotoDeleted(e),this.loadPhotos()}).catch(t=>console.log(t))},getPhotoLinks(){let e=[];for(let t=0;t<this.photos.length;t++)for(let a=0;a<this.activePhotos.length;a++)this.photos[t].id==this.activePhotos[a]&&(e[0]=this.photos[t]);return e},sendImageIdToPlaceholder(){let e=[];for(let t of this.activePhotos)e.push(this.getPhotoById(t));this.$emit("loadedImage",e)},setPhotoClass(e){this.activePhotos.includes(e)?this.activePhotos.splice(this.activePhotos.indexOf(e),1):this.activePhotos.push(e),this.sendImageIdToPlaceholder()},getPhotoById(e){for(let t=0;t<this.photos.length;t++)if(this.photos[t].id==e)return this.photos[t].path}},created(){this.loadPhotos()}},me={class:"gallery-picker-menu"},_e={class:"gallery-picker-menu__title"},fe={class:"d-flex align-items-center flex-wrap"},ge=c("div",{class:"gallery-picker__modal-title"},"GalleryPicker",-1),ve={class:"ml-3"},ye={class:"d-flex justify-content-end"},Pe=["onClick","title"],ke={key:0,class:"mask gallery-picker-photo-mask"};function be(e,t,a,w,i,n){const v=s("v-btn"),u=s("v-col"),C=s("text-field"),f=s("svg-vue"),y=s("Picture"),j=s("Pagination"),p=s("v-row"),k=s("v-container"),P=s("v-card-text"),x=s("v-card"),I=s("AddPhotos"),$=s("b-tab"),L=s("b-tabs"),z=s("b-modal"),m=H("b-tooltip");return r(),_(p,null,{default:l(()=>[o(p,{justify:"center",class:"mt-5 mb-2 px-3 gallery-picker"},{default:l(()=>[o(u,{cols:"12"},{default:l(()=>[o(v,{onClick:t[0]||(t[0]=d=>i.modal=!0),color:"primary",class:"w-100"},{default:l(()=>[J(q(a.title||"Dodaj galerię"),1)]),_:1})]),_:1}),o(z,{modelValue:i.modal,"onUpdate:modelValue":t[6]||(t[6]=d=>i.modal=d),"no-close-on-backdrop":"","no-close-on-esc":"",size:"xl","hide-footer":"","hide-header":"","modal-class":"gallery-picker",style:{"background-color":"white !important"}},{default:l(()=>[o(x,null,{default:l(()=>[c("div",me,[c("div",_e,[c("div",fe,[ge,c("div",ve,[o(C,{class:"gallery-picker__search-input",label:"Szukaj",icon:"magnify",modelValue:i.search,"onUpdate:modelValue":t[1]||(t[1]=d=>i.search=d),onInput:e.searchPhoto,"no-validation":""},null,8,["modelValue","onInput"])])]),o(v,{class:"gallery-picker-close",onClick:t[2]||(t[2]=d=>i.modal=!1),"just-icon":""},{icon:l(()=>[o(f,{icon:"close"})]),_:1})]),o(L,{class:"gallery-picker__tabs",modelValue:i.tab,"onUpdate:modelValue":t[5]||(t[5]=d=>i.tab=d),"background-color":"primary",dark:""},{default:l(()=>[(r(!0),V(F,null,A(i.tabs,(d,D)=>(r(),_($,{title:d,active:D==0,key:d},{default:l(()=>[D===0?(r(),_(x,{key:0,flat:""},{default:l(()=>[o(P,null,{default:l(()=>[o(k,null,{default:l(()=>[o(p,{class:"d-flex align-items-center"},{default:l(()=>[(r(!0),V(F,null,A(n.filteredPhotos,h=>(r(),_(u,{onMouseout:t[3]||(t[3]=T=>i.closeIcon=0),onMouseover:T=>n.showCloseIcon(h.id),class:"d-flex align-items-between flex-column",lg:"2",md:"3",cols:"6",sm:"4",key:h.id},{default:l(()=>[c("div",ye,[o(v,{"just-icon":"",onClick:T=>n.deletePhoto(h.id)},{icon:l(()=>[o(f,{class:K(["close-icon",{"close-icon--show":i.closeIcon==h.id}]),icon:"close"},null,8,["class"])]),_:2},1032,["onClick"])]),Q((r(),V("div",{onClick:T=>n.setPhotoClass(h.id),title:h.path.split("/")[1],class:"position-relative"},[o(Y,{name:"fade"},{default:l(()=>[i.activePhotos.includes(h.id)?(r(),V("div",ke)):G("",!0)]),_:2},1024),o(y,{classImg:"gallery-picker-photo",src:n.url(h.path)},null,8,["src"])],8,Pe)),[[m,void 0,void 0,{hover:!0}]])]),_:2},1032,["onMouseover"]))),128)),o(u,{cols:"12",style:{"padding-top":"2rem"}}),o(u,{cols:"12",style:{position:"sticky",bottom:"-1px","background-color":"white","z-index":"23"}},{default:l(()=>[o(j,{class:"gallery-picker-pagination",modelValue:i.page,"onUpdate:modelValue":t[4]||(t[4]=h=>i.page=h),"total-rows":i.photos.length,"per-page":12},null,8,["modelValue","total-rows"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):D===1?(r(),_(I,{key:1,onLoadPhotos:n.loadPhotos},null,8,["onLoadPhotos"])):G("",!0)]),_:2},1032,["title","active"]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ve=S(pe,[["render",be]]);const we={components:{GalleryPicker:Ve,Picture:E,VMain:ie,VContainer:ae,VCard:N,VForm:X,VBtn:R,SvgVue:Z,VCardActions:re,VDivider:se,VRow:M,VCol:B,TextField:O,VCardTitle:ne},data:()=>({name:"",rules:{titleRules:[e=>!!e||"Tytuł jest wymagany!"]},apiGallery:[],pickedGallery:[],gallery:[],currentObject:{},activePhoto:"https://via.placeholder.com/250",img:""}),computed:{formTitle(){return this.$route.path.split("/")[2]=="players"?`${this.currentObject.first_name} ${this.currentObject.last_name}`:this.currentObject.title}},methods:{getUrl(e){return U(e)},getImageDefaultPlaceholder(){return"https://via.placeholder.com/250"},setGallery(e){let t=[];for(let a of e)t.push({path:a,photo_alt:"",item_id:this.$route.params.id,table_name:this.$route.params.table});this.pickedGallery=t,this.gallery=[...this.apiGallery,...this.pickedGallery]},setImagePlaceholder(e){e==="placeholder"?(this.img="",this.activePhoto=this.getImageDefaultPlaceholder()):(this.setGallery(e),this.activePhoto=U(e))},getFormData(){return this.gallery},resetForm(){this.activePhoto=this.getImageDefaultPlaceholder()},setLoading(e){this.$store.commit("loading",e)},add(e){g.post("/api/gallery/add",e,{headers:{"Content-Type":"application/json"}}).then(t=>{this.setLoading(!1),this.$store.commit("toast",b.success),this.loadGallery(),this.resetForm()}).catch(t=>{this.$store.commit("toast",b.error),this.setLoading(!1)})},edit(e){g.put("/api/gallery/edit",e,{headers:{"Content-Type":"application/json"}}).then(t=>{this.setLoading(!1),this.$store.commit("toast",b.success),this.loadGallery()}).catch(t=>{this.$store.commit("toast",b.error),this.setLoading(!1),console.log(t)})},destroy(e){confirm("Czy na pewno chcesz usunąć to zdjęcie z galerii?")&&(this.setLoading(!0),g.delete("/api/gallery/delete/"+e).then(t=>{this.setLoading(!1),this.$store.commit("toast",b.success),this.loadGallery()}).catch(t=>{this.$store.commit("toast",b.error),this.setLoading(!1),console.log(t)}))},send(){this.getFormData().length>0&&this.setLoading(!0);for(let e of this.getFormData())e.id?this.edit(e):this.add(e)},updateDeletedPhoto(e){this.gallery.splice(this.gallery.findIndex(t=>t.path==e))},loadCurrentObject(){g.get(`/api/${this.$route.path.split("/")[2]}/get_one/${this.$route.params.id}`).then(e=>{this.currentObject=e.data})},loadGallery(){g.get(`/api/gallery/get_photos/${this.$route.path.split("/")[2]}/${this.$route.params.id}`).then(e=>{this.apiGallery=e.data,this.gallery=e.data,this.setLoading(!1)})}},created(){this.$store.hasModule("Loading")||this.$store.registerModule("Loading",ee),this.$route.path.split("/")[2]!="realizations"&&this.loadCurrentObject(),this.loadGallery(),this.setLoading(!0)}},Ce={key:0,class:"pt-4 font-weight-bold panel-title-header first-color"},je={class:"pa-5"},xe={class:"gallery-container"},Ge={class:"position-relative"},Ie={class:"close-icon-container"},$e={class:"pa-5 d-flex flex-column justify-content-between"},Le=c("span",null,"Zatwierdź",-1),ze=c("span",null,"Anuluj",-1);function De(e,t,a,w,i,n){const v=s("v-card-title"),u=s("v-divider"),C=s("Picture"),f=s("svg-vue"),y=s("v-btn"),j=s("text-field"),p=s("v-col"),k=s("v-row"),P=s("GalleryPicker"),x=s("v-card-actions"),I=s("v-form"),$=s("v-card"),L=s("v-container"),z=s("v-main");return r(),_(z,null,{default:l(()=>[o(L,null,{default:l(()=>[o($,null,{default:l(()=>[o(v,{class:"justify-content-center"},{default:l(()=>[n.formTitle!="undefined undefined"?(r(),V("h2",Ce,q(e.$route.path.split("/")[2]=="realizations"?"Realizacje":"Galeria - "+n.formTitle),1)):G("",!0)]),_:1}),o(u,{class:"mt-0"}),o(I,{ref:"form"},{default:l(()=>[o(k,null,{default:l(()=>[o(p,{cols:"12",md:"8"},{default:l(()=>[c("div",je,[c("div",xe,[o(k,null,{default:l(()=>[(r(!0),V(F,null,A(e.gallery,m=>(r(),_(p,{key:m.path,cols:"12",sm:"6",md:"4"},{default:l(()=>[c("div",Ge,[o(C,{classImg:"img-fluid",src:n.getUrl(m.path)},null,8,["src"]),c("div",Ie,[m.id?(r(),_(y,{key:0,class:"close-icon",onClick:d=>n.destroy(m.id),"just-icon":""},{icon:l(()=>[o(f,{icon:"close"})]),_:2},1032,["onClick"])):G("",!0)])]),o(j,{label:"Tekst alternatywny",modelValue:m.photo_alt,"onUpdate:modelValue":d=>m.photo_alt=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1})])])]),_:1}),o(p,{cols:"12",md:"4"},{default:l(()=>[c("div",$e,[c("div",null,[o(P,{onUpdateDeletedPhoto:n.updateDeletedPhoto,onLoadedImage:n.setImagePlaceholder,apiGallery:e.apiGallery},null,8,["onUpdateDeletedPhoto","onLoadedImage","apiGallery"])])])]),_:1})]),_:1}),o(u,{class:"mb-0"}),o(x,{class:"pa-4"},{default:l(()=>[o(y,{disabled:e.gallery.length===0,color:"primary",class:"mr-2",onClick:n.send},{icon:l(()=>[o(f,{icon:"check"})]),default:l(()=>[Le]),_:1},8,["disabled","onClick"]),o(y,{color:"error",class:"mr-2",onClick:t[0]||(t[0]=m=>e.$router.go(-1))},{icon:l(()=>[o(f,{icon:"close"})]),default:l(()=>[ze]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})}const Ne=S(we,[["render",De]]);export{Ne as default};
