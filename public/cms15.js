(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"//Qa":function(e,t,n){"use strict";n.r(t);var r=n("o0o1"),s=n.n(r),a=n("vDqi"),i=n.n(a);function o(e,t,n,r,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,s)}function l(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s,a=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){i=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u={data:function(){return{users:[],selectedUsers:[],search:"",checkboxes:[],selectPlayersFlag:!1}},watch:{selectedUsers:function(){this.$emit("users",this.selectedUsers)},search:function(){this.search=null==this.search?"":this.search}},computed:{likesAllFruit:function(){return this.selectedUsers.length===this.users.length},likesSomeFruit:function(){return this.selectedUsers.length>0&&!this.likesAllFruit},icon:function(){return this.likesAllFruit?"mdi-close-box":this.likesSomeFruit?"mdi-minus-box":"mdi-checkbox-blank-outline"},playersIcon:function(){return this.selectPlayersFlag?"mdi-close-box":"mdi-checkbox-blank-outline"}},methods:{selectPlayers:function(){if(this.selectPlayersFlag=!this.selectPlayersFlag,this.selectedUsers=[],this.selectPlayersFlag){var e,t=l(this.users);try{for(t.s();!(e=t.n()).done;){var n=e.value;"Zawodnik"==n.type&&this.selectedUsers.push(n)}}catch(e){t.e(e)}finally{t.f()}}},getUsers:function(){var e,t=this;return(e=s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.get("/api/users/get_all").then((function(e){t.users=e.data})).catch((function(e){t.$store.commit("setSnackbar","Nie udało się załadować użytkowników...")}));case 2:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function i(e){o(a,r,s,i,l,"next",e)}function l(e){o(a,r,s,i,l,"throw",e)}i(void 0)}))})()},itemText:function(e){return"".concat(e.name," (").concat(e.email,")")},toggle:function(){var e=this;this.selectPlayersFlag=!1,this.$nextTick((function(){e.likesAllFruit?e.selectedUsers=[]:e.selectedUsers=e.users.slice()}))},searchUser:function(){var e,t=[],n=l(this.users);try{for(n.s();!(e=n.n()).done;){var r=e.value;!r.name.toLowerCase().includes(this.search.toLowerCase())&&!r.email.toLowerCase().includes(this.search.toLowerCase())||t.push(r)}}catch(e){n.e(e)}finally{n.f()}return t}},created:function(){this.getUsers()}},f=n("KHd+");function d(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s,a=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){i=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw s}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t,n,r,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,s)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function i(e){v(a,r,s,i,o,"next",e)}function o(e){v(a,r,s,i,o,"throw",e)}i(void 0)}))}}var p={data:function(){return{files:[],mail:{subject:"",message:"",newsletter:!0},users:[],loading:!1,valid:!0,rules:{titleRules:[function(e){return!!e||"To pole jest wymagane!"}]}}},components:{Select:Object(f.a)(u,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{attrs:{fluid:""}},[n("v-select",{attrs:{items:e.searchUser(),"return-object":"","item-text":e.itemText,label:"Użytkownicy",multiple:"",chips:""},scopedSlots:e._u([{key:"prepend-item",fn:function(){return[n("v-list-item",[n("v-text-field",{attrs:{label:"Znajdź"},on:{keyup:e.searchUser},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),n("v-list-item",{attrs:{ripple:""},on:{click:e.toggle}},[n("v-list-item-action",[n("v-icon",{attrs:{color:e.selectedUsers.length>0?"primary":""}},[e._v("\n\t\t\t\t\t\t"+e._s(e.icon)+"\n\t\t\t\t\t")])],1),e._v(" "),n("v-list-item-content",[n("v-list-item-title",[e._v("\n\t\t\t\t\t\tWybierz wszystkich\n\t\t\t\t\t")])],1)],1),e._v(" "),n("v-list-item",{attrs:{ripple:""},on:{click:e.selectPlayers}},[n("v-list-item-action",[n("v-icon",{attrs:{color:e.selectedUsers.length>0?"primary":""}},[e._v("\n\t\t\t\t\t\t"+e._s(e.playersIcon)+"\n\t\t\t\t\t")])],1),e._v(" "),n("v-list-item-content",[n("v-list-item-title",[e._v("\n\t\t\t\t\t\tTylko zawodnicy\n\t\t\t\t\t")])],1)],1),e._v(" "),n("v-divider",{staticClass:"mt-2"})]},proxy:!0},{key:"selection",fn:function(t){var r=t.item;return[n("v-chip",{attrs:{color:"primary"}},[e._v(e._s(r.name))])]}}]),model:{value:e.selectedUsers,callback:function(t){e.selectedUsers=t},expression:"selectedUsers"}})],1)}),[],!1,null,null,null).exports},methods:{deleteMail:function(e){i.a.delete("/api/mails/delete/"+e.id)},sendMail:function(e){var t=this;return h(s.a.mark((function n(){var r,a,o,l;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=0,a=d(t.users),n.prev=2,a.s();case 4:if((o=a.n()).done){n.next=14;break}return l=o.value,e.email=l.email,e.newsletter=1,r==t.users.length-1&&(e.delete=1),n.next=11,i.a.post("/api/mails/send",e).then((function(n){t.loading=!1,null!=n.data.error?t.$store.commit("setSnackbar",n.data.error.message):null!=n.data.success&&t.$store.commit("setSnackbar",n.data.success.message),r==t.users.length-1&&n.data.success&&(t.$refs.form.reset(),t.$refs.form.resetValidation(),t.deleteMail(e))})).catch((function(e){console.log(e),t.loading=!1,t.$store.commit("setSnackbar","Przepraszamy, nie udało się wysłać maila...")}));case 11:r++;case 12:n.next=4;break;case 14:n.next=19;break;case 16:n.prev=16,n.t0=n.catch(2),a.e(n.t0);case 19:return n.prev=19,a.f(),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[2,16,19,22]])})))()},saveAttachments:function(e){var t=this;return h(s.a.mark((function n(){var r,a;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=s.a.mark((function n(r){var a;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(a=new FormData).append("file",t.files[r]),a.append("mail_id",e.id),n.next=5,i.a.post("/api/attachments/add",a).then((function(n){r==t.files.length-1&&t.sendMail(e)})).catch((function(e){t.loading=!1,console.log(e),t.$store.commit("setSnackbar","Przepraszamy, nie udało się wysłać załączników...")}));case 5:case"end":return n.stop()}}),n)})),a=0;case 2:if(!(a<t.files.length)){n.next=7;break}return n.delegateYield(r(a),"t0",4);case 4:a++,n.next=2;break;case 7:case"end":return n.stop()}}),n)})))()},saveMail:function(){var e=this;this.valid&&(this.loading=!0,i.a.post("/api/mails/add",this.mail).then((function(t){e.files.length>0?e.saveAttachments(t.data):e.sendMail(t.data)})).catch((function(t){console.log(t),e.loading=!1,e.$store.commit("setSnackbar","Przepraszamy, błąd serwera...")})))}}},y=Object(f.a)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-content",[n("v-container",[n("v-card",[n("v-card-title",{staticClass:"justify-content-center"},[n("h2",{staticClass:"pt-4 font-weight-bold panel-title-header first-color"},[e._v("\n          Wysyłanie maila do użytkowników\n        ")])]),e._v(" "),n("v-divider",{staticClass:"mt-0"}),e._v(" "),n("v-form",{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[n("v-row",{staticClass:"px-5"},[n("v-col",{attrs:{cols:"12"}},[n("v-text-field",{attrs:{color:"primary",rules:e.rules.titleRules,label:"Temat Twojej wiadomości"},model:{value:e.mail.subject,callback:function(t){e.$set(e.mail,"subject",t)},expression:"mail.subject"}}),e._v(" "),n("v-textarea",{attrs:{color:"primary",rules:e.rules.titleRules,rows:"5",label:"Twoja wiadomość"},model:{value:e.mail.message,callback:function(t){e.$set(e.mail,"message",t)},expression:"mail.message"}}),e._v(" "),n("Select",{on:{users:function(t){e.users=t}}})],1)],1),e._v(" "),n("v-divider",{staticClass:"mb-0"}),e._v(" "),n("v-card-actions",{staticClass:"pa-4"},[n("v-btn",{staticClass:"mr-2",attrs:{loading:e.loading,disabled:!e.valid||0==e.users.length,color:"primary"},on:{click:e.saveMail}},[n("v-icon",{attrs:{left:""}},[e._v("mdi-check")]),e._v(" "),n("span",[e._v("Wyślij")])],1),e._v(" "),n("v-btn",{staticClass:"mr-2",attrs:{color:"error"},on:{click:function(t){return e.$router.go(-1)}}},[n("v-icon",{attrs:{left:""}},[e._v("mdi-close")]),e._v(" "),n("span",[e._v("Wróć")])],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null);t.default=y.exports}}]);
//# sourceMappingURL=cms15.js.map