(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"//Qa":function(t,e,n){"use strict";n.r(e);var r=n("o0o1"),s=n.n(r),a=n("vDqi"),i=n.n(a);function o(t,e,n,r,s,a,i){try{var o=t[a](i),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(r,s)}function l(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s,a=!0,i=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){i=!0,s=t},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw s}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var u={data:function(){return{users:[],selectedUsers:[],search:"",checkboxes:[],selectPlayersFlag:!1}},watch:{selectedUsers:function(){this.$emit("users",this.selectedUsers)},search:function(){this.search=null==this.search?"":this.search}},computed:{likesAllFruit:function(){return this.selectedUsers.length===this.users.length},likesSomeFruit:function(){return this.selectedUsers.length>0&&!this.likesAllFruit},icon:function(){return this.likesAllFruit?"mdi-close-box":this.likesSomeFruit?"mdi-minus-box":"mdi-checkbox-blank-outline"},playersIcon:function(){return this.selectPlayersFlag?"mdi-close-box":"mdi-checkbox-blank-outline"}},methods:{selectPlayers:function(){if(this.selectPlayersFlag=!this.selectPlayersFlag,this.selectedUsers=[],this.selectPlayersFlag){var t,e=l(this.users);try{for(e.s();!(t=e.n()).done;){var n=t.value;"Zawodnik"==n.type&&this.selectedUsers.push(n)}}catch(t){e.e(t)}finally{e.f()}}},getUsers:function(){var t,e=this;return(t=s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.get("/api/users/get_all").then((function(t){e.users=t.data})).catch((function(t){e.$store.commit("setSnackbar","Nie udało się załadować użytkowników...")}));case 2:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,s){var a=t.apply(e,n);function i(t){o(a,r,s,i,l,"next",t)}function l(t){o(a,r,s,i,l,"throw",t)}i(void 0)}))})()},itemText:function(t){return"".concat(t.name," (").concat(t.email,")")},toggle:function(){var t=this;this.selectPlayersFlag=!1,this.$nextTick((function(){t.likesAllFruit?t.selectedUsers=[]:t.selectedUsers=t.users.slice()}))},searchUser:function(){var t,e=[],n=l(this.users);try{for(n.s();!(t=n.n()).done;){var r=t.value;!r.name.toLowerCase().includes(this.search.toLowerCase())&&!r.email.toLowerCase().includes(this.search.toLowerCase())||e.push(r)}}catch(t){n.e(t)}finally{n.f()}return e}},created:function(){this.getUsers()}},f=n("KHd+");function d(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s,a=!0,i=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){i=!0,s=t},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw s}}}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function m(t,e,n,r,s,a,i){try{var o=t[a](i),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(r,s)}function h(t){return function(){var e=this,n=arguments;return new Promise((function(r,s){var a=t.apply(e,n);function i(t){m(a,r,s,i,o,"next",t)}function o(t){m(a,r,s,i,o,"throw",t)}i(void 0)}))}}var p={data:function(){return{files:[],mail:{subject:"",message:"",newsletter:!0},users:[],loading:!1,valid:!0,rules:{titleRules:[function(t){return!!t||"To pole jest wymagane!"}]}}},components:{Select:Object(f.a)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{attrs:{fluid:""}},[n("v-select",{attrs:{items:t.searchUser(),"return-object":"","item-text":t.itemText,label:"Użytkownicy",multiple:"",chips:""},scopedSlots:t._u([{key:"prepend-item",fn:function(){return[n("v-list-item",[n("v-text-field",{attrs:{label:"Znajdź"},on:{keyup:t.searchUser},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),n("v-list-item",{attrs:{ripple:""},on:{click:t.toggle}},[n("v-list-item-action",[n("v-icon",{attrs:{color:t.selectedUsers.length>0?"primary":""}},[t._v("\n\t\t\t\t\t\t"+t._s(t.icon)+"\n\t\t\t\t\t")])],1),t._v(" "),n("v-list-item-content",[n("v-list-item-title",[t._v("\n\t\t\t\t\t\tWybierz wszystkich\n\t\t\t\t\t")])],1)],1),t._v(" "),n("v-list-item",{attrs:{ripple:""},on:{click:t.selectPlayers}},[n("v-list-item-action",[n("v-icon",{attrs:{color:t.selectedUsers.length>0?"primary":""}},[t._v("\n\t\t\t\t\t\t"+t._s(t.playersIcon)+"\n\t\t\t\t\t")])],1),t._v(" "),n("v-list-item-content",[n("v-list-item-title",[t._v("\n\t\t\t\t\t\tTylko zawodnicy\n\t\t\t\t\t")])],1)],1),t._v(" "),n("v-divider",{staticClass:"mt-2"})]},proxy:!0},{key:"selection",fn:function(e){var r=e.item;return[n("v-chip",{attrs:{color:"primary"}},[t._v(t._s(r.name))])]}}]),model:{value:t.selectedUsers,callback:function(e){t.selectedUsers=e},expression:"selectedUsers"}})],1)}),[],!1,null,null,null).exports},methods:{deleteMail:function(t){i.a.delete("/api/mails/delete/"+t.id)},sendMail:function(t){var e=this;return h(s.a.mark((function n(){var r,a,o,l;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=0,a=d(e.users),n.prev=2,a.s();case 4:if((o=a.n()).done){n.next=14;break}return l=o.value,t.email=l.email,t.newsletter=1,r==e.users.length-1&&(t.delete=1),n.next=11,i.a.post("/api/mails/send",t).then((function(n){e.loading=!1,null!=n.data.error?e.$store.commit("setSnackbar",n.data.error.message):null!=n.data.success&&e.$store.commit("setSnackbar",n.data.success.message),r==e.users.length-1&&n.data.success&&(e.$refs.form.reset(),e.$refs.form.resetValidation(),e.deleteMail(t))})).catch((function(t){console.log(t),e.loading=!1,e.$store.commit("setSnackbar","Przepraszamy, nie udało się wysłać maila...")}));case 11:r++;case 12:n.next=4;break;case 14:n.next=19;break;case 16:n.prev=16,n.t0=n.catch(2),a.e(n.t0);case 19:return n.prev=19,a.f(),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[2,16,19,22]])})))()},saveAttachments:function(t){var e=this;return h(s.a.mark((function n(){var r,a;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=s.a.mark((function n(r){var a;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(a=new FormData).append("file",e.files[r]),a.append("mail_id",t.id),n.next=5,i.a.post("/api/attachments/add",a).then((function(n){r==e.files.length-1&&e.sendMail(t)})).catch((function(t){e.loading=!1,console.log(t),e.$store.commit("setSnackbar","Przepraszamy, nie udało się wysłać załączników...")}));case 5:case"end":return n.stop()}}),n)})),a=0;case 2:if(!(a<e.files.length)){n.next=7;break}return n.delegateYield(r(a),"t0",4);case 4:a++,n.next=2;break;case 7:case"end":return n.stop()}}),n)})))()},saveMail:function(){var t=this;this.valid&&(this.loading=!0,i.a.post("/api/mails/add",this.mail).then((function(e){t.files.length>0?t.saveAttachments(e.data):t.sendMail(e.data)})).catch((function(e){console.log(e),t.loading=!1,t.$store.commit("setSnackbar","Przepraszamy, błąd serwera...")})))}}},y=Object(f.a)(p,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-content",[n("v-container",[n("v-card",[n("v-card-title",{staticClass:"justify-content-center"},[n("h2",{staticClass:" pt-4 font-weight-bold panel-title-header first-color"},[t._v("\n                    Wysyłanie maila do użytkowników\n                ")])]),t._v(" "),n("v-divider",{staticClass:"mt-0"}),t._v(" "),n("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[n("v-row",{staticClass:"px-5"},[n("v-col",{attrs:{cols:"12"}},[n("v-text-field",{attrs:{color:"primary",rules:t.rules.titleRules,label:"Temat Twojej wiadomości"},model:{value:t.mail.subject,callback:function(e){t.$set(t.mail,"subject",e)},expression:"mail.subject"}}),t._v(" "),n("v-textarea",{attrs:{color:"primary",rules:t.rules.titleRules,rows:"5",label:"Twoja wiadomość"},model:{value:t.mail.message,callback:function(e){t.$set(t.mail,"message",e)},expression:"mail.message"}}),t._v(" "),n("Select",{on:{users:function(e){t.users=e}}})],1)],1),t._v(" "),n("v-divider",{staticClass:"mb-0"}),t._v(" "),n("v-card-actions",{staticClass:"pa-4"},[n("v-btn",{staticClass:"mr-2",attrs:{loading:t.loading,disabled:!t.valid||0==t.users.length,color:"primary"},on:{click:t.saveMail}},[n("v-icon",{attrs:{left:""}},[t._v("mdi-check")]),t._v(" "),n("span",[t._v("Wyślij")])],1),t._v(" "),n("v-btn",{staticClass:"mr-2",attrs:{color:"error"},on:{click:function(e){return t.$router.go(-1)}}},[n("v-icon",{attrs:{left:""}},[t._v("mdi-close")]),t._v(" "),n("span",[t._v("Wróć")])],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null);e.default=y.exports}}]);
//# sourceMappingURL=cms15.js.map